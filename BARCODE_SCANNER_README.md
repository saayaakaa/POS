# 📱 バーコードスキャナー機能

POSシステムにWebカメラを使用したバーコードスキャン機能を追加しました。

## 🚀 機能概要

### レベル2対応: バーコードスキャン機能
- **Webカメラ対応**: ブラウザのカメラAPIを使用
- **JANコード13桁**: 自動検証・フィルタリング
- **リアルタイムスキャン**: 瞬時にバーコードを認識
- **手入力併用**: 従来の手入力も継続サポート

## 🛠️ 技術仕様

### フロントエンド
- **ライブラリ**: ZXing (@zxing/library, @zxing/browser)
- **カメラAPI**: MediaDevices.getUserMedia()
- **権限管理**: Navigator.permissions API
- **UI**: React + TypeScript + Tailwind CSS

### 対応バーコード形式
- **JANコード**: 13桁数字（例：4901234567001）
- **自動検証**: 13桁以外は自動的に拒否
- **エラーハンドリング**: 無効なコードの場合は警告表示

## 📋 使用方法

### 1. 手入力モード
```
1. 商品コード入力欄に13桁の数字を入力
2. 「商品を検索」ボタンをクリック
3. 商品情報が表示される
```

### 2. バーコードスキャンモード
```
1. 📷「スキャン」ボタンをクリック
2. カメラ権限を許可
3. バーコードを赤い枠内に合わせる
4. 自動的に読み取り・検索が実行される
```

## 🔧 セットアップ

### 依存関係のインストール
```bash
cd frontend
npm install @zxing/library @zxing/browser
```

### 開発サーバー起動
```bash
# バックエンド
cd backend
python app.py

# フロントエンド
cd frontend
npm run dev
```

### テストページ
```
http://localhost:3000/scanner-test
```

## 📱 ブラウザ対応

### 推奨環境
- **Chrome**: 最新版（推奨）
- **Firefox**: 最新版
- **Safari**: iOS 14.3+, macOS Big Sur+
- **Edge**: 最新版

### カメラ権限
- **HTTPS必須**: 本番環境ではHTTPS接続が必要
- **権限許可**: 初回アクセス時にカメラ権限の許可が必要
- **プライバシー**: カメラ映像はローカル処理のみ

## 🎯 テスト用商品コード

### 通常商品
- `4901234567001` - シャープペンシル（0.5mm）
- `4901234567002` - 消しゴム（スリムタイプ）
- `4901234567003` - ノートB5（横罫）

### 地域限定商品
- `4901234567101` - 名古屋限定・しゃちほこ消しゴム
- `4901234567102` - 大阪限定・たこ焼きメモ帳

## 🚀 Azure デプロイ対応

### 環境変数設定
```bash
# フロントエンド (.env.local)
NEXT_PUBLIC_API_URL=https://your-backend-app.azurewebsites.net

# バックエンド (Azure App Service)
ENVIRONMENT=production
ALLOWED_ORIGINS=https://your-frontend-domain.com
```

### HTTPS対応
- Azure Static Web Apps: 自動HTTPS
- Azure App Service: 自動HTTPS
- カメラAPI: HTTPS環境で正常動作

## 🔍 トラブルシューティング

### カメラが起動しない
1. ブラウザの設定でカメラ権限を確認
2. HTTPS接続を確認（localhost以外）
3. 他のアプリケーションがカメラを使用していないか確認

### バーコードが読み取れない
1. 照明を明るくする
2. バーコードを赤い枠内に正確に合わせる
3. カメラとバーコードの距離を調整（10-30cm推奨）
4. バーコードの汚れや損傷を確認

### API接続エラー
1. バックエンドサーバーの起動を確認
2. CORS設定を確認
3. ネットワーク接続を確認

## 📈 今後の拡張予定

### レベル3: 高度な機能
- **複数バーコード同時読み取り**
- **QRコード対応**
- **商品画像認識**
- **在庫管理連携**

### パフォーマンス最適化
- **WebAssembly対応**
- **オフライン機能**
- **PWA対応**

## モバイルデバイス対応

### HTTPS要件
モバイルブラウザでバーコードスキャナーを使用するには、**HTTPS接続が必須**です。

#### 開発環境でのHTTPS設定

1. **証明書の生成**
```bash
cd frontend
./scripts/generate-cert.sh
```

2. **HTTPS開発サーバーの起動**
```bash
# バックエンド（HTTP）
cd backend
python app.py

# フロントエンド（HTTPS）
cd frontend
npm run dev:https
```

3. **アクセス方法**
- PC: https://localhost:3000
- モバイル: https://192.168.11.12:3000 （IPアドレスは環境に応じて変更）

#### ブラウザの警告について
自己署名証明書を使用するため、初回アクセス時にセキュリティ警告が表示されます：
- Chrome: 「詳細設定」→「localhost にアクセスする（安全ではありません）」
- Safari: 「詳細」→「このWebサイトにアクセス」
- Firefox: 「詳細設定」→「例外を追加」

### 対応ブラウザ
- **Chrome 53+** (推奨)
- **Safari 11+**
- **Firefox 36+**
- **Edge 12+**

### トラブルシューティング

#### エラー: `navigator.mediaDevices is undefined`
**原因**: HTTP接続でのカメラアクセス制限
**解決策**: HTTPS接続を使用してください

#### エラー: `NotAllowedError`
**原因**: カメラ権限が拒否されている
**解決策**: 
1. ブラウザの設定でカメラ権限を許可
2. アドレスバーのカメラアイコンをクリックして許可

#### エラー: `NotFoundError`
**原因**: カメラデバイスが見つからない
**解決策**: 
1. カメラが正しく接続されているか確認
2. 他のアプリでカメラが使用中でないか確認

#### エラー: `NotReadableError`
**原因**: カメラが他のアプリで使用中
**解決策**: 他のカメラアプリを閉じてから再試行 